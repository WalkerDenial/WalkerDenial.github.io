<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="Walker Denial">
  <meta name="description" content="This is Walker Denial&#39;s blog!">
  
  <title>Walker Denial</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<meta name="generator" content="Hexo 7.0.0-rc2"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu" ><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav" >
    <div class="nav-header"  style="background-image: url(/images/header-bg.png);background-color:#26A69A">
    <div class="header-box"><img src="/images/profile.png" ondragstart="return false;"></div>
    <p>Walker Denial</p>
    <div class="nav-link">
        
        <a href="https://twitter.com/WalkerDenial" target="_blank"> <div class="link-box twitter"></div></a>
        
        
        <a  href="https://github.com/WalkerDenial" target="_blank"><div class="link-box github"></div></a>
        
        
        <a href="mailto:mailto:WalkerDenial@gmail.com"><div class="link-box email"></div></a>
        
        
        <a href="http://weibo.com/u/3213135930" target="_blank"><div class="link-box weibo"></div></a>
        
        
        <a href="https://www.zhihu.com/people/walkerdenial/activities" target="_blank"> <div class="link-box zhihu"></div></a>
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- æœç´¢æ¡†ç›¸å…³ -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="æœç´¢..." class="search form-control" autocomplete="off" autocorrect="off"/>
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- æœç´¢ç»“æœåŒº -->
        <p class='no-result'>æ— æœç´¢ç»“æœ</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>ä¸»é¡µ</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a  class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>å½’æ¡£</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2022/06/">June 2022<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/05/">May 2022<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/04/">April 2022<span class="archive-count">4</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/03/">March 2022<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/12/">December 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/11/">November 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/09/">September 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/08/">August 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/04/">April 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/03/">March 2021<span class="archive-count">12</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/02/">February 2021<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/01/">January 2021<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/12/">December 2020<span class="archive-count">5</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/11/">November 2020<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/04/">April 2020<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/01/">January 2018<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/12/">December 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/11/">November 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/08/">August 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/07/">July 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/03/">March 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/02/">February 2017<span class="archive-count">20</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/01/">January 2017<span class="archive-count">2</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a   class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>åˆ†ç±»</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/Algorithm/">Algorithm<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/ES6/">ES6<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Flutter/">Flutter<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Gradle/">Gradle<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Java/">Java<span class="category-count">6</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Kotlin/">Kotlin<span class="category-count">4</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/RPC/">RPC<span class="category-count">3</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/UML/">UML<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">å…¶ä»–<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%86%99%E4%BD%9C/">å†™ä½œ<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯<span class="category-count">10</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%87%AA%E5%AD%A6/">è‡ªå­¦<span class="category-count">9</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/">è®¡ç®—æœºç³»ç»Ÿç»“æ„<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">è®¡ç®—æœºç½‘ç»œ<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼<span class="category-count">27</span></a>
    </li>
</ul>
<!--tags-->

<li class="nav-list">
    <a href="/archives" target="_self">
        <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>æ ‡ç­¾</p>
    </a>
</li>

<!--photo-->

<!--friends-->

<!--about-->

<li class="nav-list">
    <a href="/about" target="_self">
        <div class="nav-ico"><i class="material-icons">copyright</i> </div><p>å…³äº</p>
    </a>
</li>


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title"  style="background-color:#26A69A;background-image:url(/images/random/vateral-5.png)" >
  <h2>å¤šçº¿ç¨‹</h2>
    
  <p>ä½œè€… : Walker Denial &nbsp&nbsp å‘å¸ƒäº : <time datetime="2020-12-30T15:07:00.000Z">
          2020-12-30
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œé‡åˆ° IO æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰è€—æ—¶æ“ä½œï¼Œé€šå¸¸éƒ½ä¼šæ”¾åˆ°å­çº¿ç¨‹ä¸­å»å¤„ç†ï¼Œå¦‚æœæœ‰å¤šä¸ªæ“ä½œï¼Œå°±æ¶‰åŠåˆ°äº† <strong>å¤šçº¿ç¨‹</strong>ï¼Œç°åœ¨å°±æ¥æ‰’ä¸€æ‰’ <strong>å¤šçº¿ç¨‹</strong>ï¼Œç„¶ååŸºäºæ‰’çš®ä¹‹åçš„ç»“æœï¼Œè¿›è¡Œçº¿ç¨‹ä¼˜åŒ–ã€‚</p>
<p>åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œå…ˆä»‹ç»ä¸€ä¸‹åŸºç¡€æ¦‚å¿µï¼Œä¸ä»…è¦çŸ¥å…¶ç„¶ï¼Œè¿˜è¦çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p>
<h1 id="1-åŸºç¡€æ¦‚å¿µ"><a href="#1-åŸºç¡€æ¦‚å¿µ" class="headerlink" title="1. åŸºç¡€æ¦‚å¿µ"></a>1. åŸºç¡€æ¦‚å¿µ</h1><blockquote>
<p><code>æ—¶é’Ÿé¢‘ç‡</code>ï¼šæ—¶é’Ÿé¢‘ç‡ï¼ˆåˆè¯‘ï¼šæ—¶é’Ÿé¢‘ç‡é€Ÿåº¦ï¼Œè‹±è¯­ï¼šclock rateï¼‰ï¼Œæ˜¯æŒ‡åŒæ­¥ç”µè·¯ä¸­æ—¶é’Ÿçš„åŸºç¡€é¢‘ç‡ï¼Œå®ƒä»¥ã€Œè‹¥å¹²æ¬¡å‘¨æœŸæ¯ç§’ã€æ¥åº¦é‡ï¼Œé‡åº¦å•ä½é‡‡ç”¨ SI å•ä½èµ«å…¹ï¼ˆHzï¼‰ã€‚</p>
<p><code>ä¸»é¢‘</code>ï¼šä¸»é¢‘å³ CPU çš„æ—¶é’Ÿé¢‘ç‡ï¼Œè®¡ç®—æœºçš„æ“ä½œåœ¨æ—¶é’Ÿä¿¡å·çš„æ§åˆ¶ä¸‹åˆ†æ­¥æ‰§è¡Œï¼Œæ¯ä¸ªæ—¶é’Ÿä¿¡å·å‘¨æœŸå®Œæˆä¸€æ­¥æ“ä½œï¼Œæ—¶é’Ÿé¢‘ç‡çš„é«˜ä½åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šåæ˜ äº† CPU é€Ÿåº¦çš„å¿«æ…¢ã€‚</p>
<p><code>å¤–é¢‘</code>ï¼šæ˜¯ CPU å¤–éƒ¨çš„å·¥ä½œé¢‘ç‡ï¼Œæ˜¯ç”±ä¸»æ¿æä¾›çš„åŸºå‡†æ—¶é’Ÿé¢‘ç‡ã€‚</p>
<p><code>FSB é¢‘ç‡</code>ï¼šæ˜¯è¿æ¥ CPU å’Œä¸»æ¿èŠ¯ç‰‡ç»„ä¸­çš„åŒ—æ¡¥èŠ¯ç‰‡çš„å‰ç«¯æ€»çº¿ï¼ˆFront Side Busï¼‰ä¸Šçš„æ•°æ®ä¼ è¾“é¢‘ç‡ã€‚</p>
<p>CPU çš„ä¸»é¢‘å’Œå¤–é¢‘é—´å­˜åœ¨è¿™æ ·çš„å…³ç³»ï¼šä¸»é¢‘ &#x3D; å¤–é¢‘ Ã— å€é¢‘ã€‚</p>
<p><code>è¿›ç¨‹</code>ï¼šè¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€‚</p>
<p><code>çº¿ç¨‹</code>ï¼šçº¿ç¨‹ï¼ˆè‹±è¯­ï¼šthreadï¼‰æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚</p>
<p><code>å¹¶å‘</code>ï¼šåœ¨åŒä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œä¸¤ä¸ªæˆ–å¤šä¸ªç¨‹åºæ‰§è¡Œï¼Œæœ‰æ—¶é—´ä¸Šçš„é‡å ï¼ˆå®è§‚ä¸Šæ˜¯åŒæ—¶ï¼Œå¾®è§‚ä¸Šä»æ˜¯é¡ºåºæ‰§è¡Œï¼‰ã€‚</p>
<p><code>å¹¶è¡Œ</code>ï¼šä¸€ç»„ç¨‹åºæŒ‰ç‹¬ç«‹å¼‚æ­¥çš„é€Ÿåº¦æ‰§è¡Œï¼Œä¸ç­‰äºæ—¶é—´ä¸Šçš„é‡å ï¼ˆåŒä¸€ä¸ªæ—¶åˆ»å‘ç”Ÿ)ã€‚</p>
</blockquote>
<p>ä»ç†è®ºä¸Šæ¥è®²ï¼Œ<strong>ä¸»é¢‘</strong> è¶Šé«˜ï¼ŒCPU è¿ç®—èƒ½åŠ›è¶Šå¼ºï¼Œå†æ ¹æ® <code>æ‘©å°”å®šå¾‹</code> æ¥çœ‹ï¼Œæ¯è¿‡ 18 ä¸ªæœˆè®¡ç®—æœºæ€§èƒ½å°±ä¼šç¿»ä¸€å€ï¼Œé‚£ä¹ˆå²‚ä¸æ˜¯åªç®¡æå‡ <strong>ä¸»é¢‘</strong> å°±è¡Œäº†ï¼Œè¿˜æœ‰ <strong>å¤šçº¿ç¨‹</strong> ä»€ä¹ˆäº‹æƒ…å•Šã€‚</p>
<p>å…¶å®ä¸ç„¶ï¼Œåˆ°ç›®å‰çš„å‘å±•çŠ¶å†µæ¥çœ‹ï¼Œç”±äºCPUæ˜¯åœ¨åŠå¯¼ä½“ç¡…ç‰‡ä¸Šåˆ¶é€ çš„ï¼Œåœ¨ç¡…ç‰‡ä¸Šçš„å…ƒä»¶ä¹‹é—´éœ€è¦å¯¼çº¿è¿›è¡Œè”æ¥ï¼Œç”±äºåœ¨é«˜é¢‘çŠ¶æ€ä¸‹è¦æ±‚å¯¼çº¿è¶Šç»†è¶ŠçŸ­è¶Šå¥½ï¼Œè¿™æ ·æ‰èƒ½å‡å°å¯¼çº¿åˆ†å¸ƒç”µå®¹ç­‰æ‚æ•£å¹²æ‰°ä»¥ä¿è¯ CPU è¿ç®—æ­£ç¡®ã€‚å› æ­¤åˆ¶é€ å·¥è‰ºçš„é™åˆ¶ï¼Œæ˜¯ CPU ä¸»é¢‘å‘å±•çš„æœ€å¤§éšœç¢ä¹‹ä¸€ã€‚</p>
<p>ä¸¾ä¸ªæ —å­å°±æ˜ç™½äº†ã€‚ä»¥å‰çš„ç»¿çš®ç«è½¦ç‰¹åˆ«ç‰¹åˆ«æ…¢ï¼Œå¯¼è‡´åœ¨ä¸€ä¸ªæ—¶é—´å‘¨æœŸå†…ï¼Œåªèƒ½è·‘ä¸€æ¬¡è¿è¾“ï¼Œç›¸å½“äºæ—©æœŸçš„ CPUï¼›åæ¥ï¼Œåˆ—è½¦é€Ÿåº¦ä¸æ–­æå‡ï¼Œæœ‰äº†å¿«è½¦ï¼›å†åæ¥ï¼Œæœ‰äº†åŠ¨è½¦ï¼›ç°åœ¨ï¼Œæœ‰äº†é«˜é“å’Œå¤å…´å·ã€‚åœ¨åŒä¸€ä¸ªæ—¶é—´å‘¨æœŸå†…ï¼Œç»¿çš®ç«è½¦åªèƒ½å®Œæˆä¸€æ¬¡è¿è¾“ï¼Œå¤å…´å·å´å¯ä»¥å®Œæˆ 4~5 æ¬¡è¿è¾“ï¼ˆç›¸å½“äºä¸»é¢‘æå‡ï¼‰ï¼Œæ•ˆç‡å¤§å¤§æå‡ã€‚å¯æ˜¯å½“è¾¾åˆ°ä¸€å®šçš„é€Ÿåº¦åï¼Œå†æƒ³æå‡é€Ÿåº¦å°±å¾ˆéš¾äº†ã€‚</p>
<p>é‚£ä¹ˆâ€¦æ€§èƒ½æå‡å‘å±•åˆ°æ­¤åœæ­¢äº†å—ï¼Ÿ</p>
<p>ä¸å­˜åœ¨çš„ï¼Œæ—¢ç„¶ <strong>ä¸»é¢‘</strong> æå‡å›°éš¾ï¼Œé‚£å¤šä¸ª CPU ä¸€èµ·è¿è¡Œï¼Œä¸ä¹Ÿå¯ä»¥æå‡æ€§èƒ½å˜›ï¼Œå¤šæ ¸å°±æ¶‰åŠåˆ°äº†å¤šçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä»Šå¤©è¦è®²çš„ä¸»é¢˜çš„ç”±æ¥ã€‚</p>
<p>æ¥ä¸Šä¸ªğŸŒ°ï¼Œé“ºè®¾å¤šæ¡è½¨é“ï¼ŒåŒæ—¶è·‘å¤šåˆ—è½¦ï¼Œæ€§èƒ½ä¸å°±æå‡èµ·æ¥äº†å˜›ã€‚</p>
<h1 id="2-æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ç¤ºä¾‹"><a href="#2-æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ç¤ºä¾‹" class="headerlink" title="2. æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ç¤ºä¾‹"></a>2. æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ç¤ºä¾‹</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// è™šæ‹Ÿæœºçº¿ç¨‹ç®¡ç†æ¥å£</span></span><br><span class="line">    <span class="type">ThreadMXBean</span> <span class="variable">threadMXBean</span> <span class="operator">=</span> ManagementFactory.getThreadMXBean();</span><br><span class="line">    <span class="comment">// è·å»çº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line">    ThreadInfo[] threadInfos = threadMXBean.dumpAllThreads(<span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// è¾“å‡ºçº¿ç¨‹ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">for</span> (ThreadInfo threadInfo : threadInfos) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;[&quot;</span> + threadInfo.getThreadId() + <span class="string">&quot;]&quot;</span> + <span class="string">&quot; &quot;</span> + threadInfo.getThreadName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨ä¸Šè¿°æ–¹æ³•åï¼Œä¼šè¾“å‡ºè™šæ‹Ÿæœºä¸­çš„çº¿ç¨‹ä¿¡æ¯ï¼Œæˆ‘ç”µè„‘ä¸Šçš„è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<pre><code>[4] Signal Dispatcher // ä¿¡ä»¤åˆ†å‘
[3] Finalizer // å¯¹è±¡è¢«é”€æ¯æ—¶è°ƒç”¨ï¼Œä½†æ˜¯ä¸ä¸€å®šç™¾åˆ†æ¯”è°ƒç”¨æˆåŠŸ
[2] Reference Handler // å¼•ç”¨å¤„ç†
[1] main // ä¸»çº¿ç¨‹
</code></pre>
<h1 id="3-çº¿ç¨‹çš„ä½¿ç”¨"><a href="#3-çº¿ç¨‹çš„ä½¿ç”¨" class="headerlink" title="3. çº¿ç¨‹çš„ä½¿ç”¨"></a>3. çº¿ç¨‹çš„ä½¿ç”¨</h1><p>ä¸€èˆ¬æ¥è®²ï¼Œæƒ³ä½¿ç”¨çº¿ç¨‹ï¼Œæœ‰ 3 ç§æ–¹å¼ï¼š</p>
<p>æ–¹å¼ 1ï¼šç»§æ‰¿ Thread</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. æ´¾ç”Ÿ Thread</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UseThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.run();</span><br><span class="line">        System.out.println(<span class="string">&quot;I am extends Thread&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ 2ï¼šå®ç° Runnable</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UseRun</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I am implements Runnable&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–¹å¼ 3ï¼šå®ç° Callableï¼Œæœ‰è¿”å›å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UseCall</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I am implements Callable&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Call result&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®é™…è€Œè¨€ï¼Œåªæœ‰ç¬¬ä¸€ç§æ‰èƒ½ç®—ç§°å¾—ä¸Š <code>çº¿ç¨‹</code>ï¼ŒRunnable å’Œ Callable è¡¨ç¤ºçš„æ˜¯ <code>çº¿ç¨‹</code> ä¸­çš„ <strong>ä»»åŠ¡</strong>ï¼Œè€Œéçº¿ç¨‹ï¼Œè¿˜æ˜¯éœ€è¦ä¼ é€’åˆ° <code>çº¿ç¨‹</code> ä¸­ï¼Œé€šè¿‡ <code>çº¿ç¨‹</code> çš„ start() æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p>
<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ExecutionException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InterruptedException</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å®é™…è€Œè¨€ï¼Œåªæœ‰ Thread æ‰èƒ½ä»£è¡¨çº¿ç¨‹ï¼›</span></span><br><span class="line"><span class="comment"> * Runnableã€Callable è¡¨ç¤ºçš„æ˜¯ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäº Thread æ´¾ç”Ÿå¯åŠ¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">UseThread</span> <span class="variable">useThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UseThread</span>();</span><br><span class="line">    useThread.start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŸºäº Runnable å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">UseRun</span> <span class="variable">useRun</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UseRun</span>();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(useRun).start();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ Callable å¯ä»¥è·å–å›è°ƒä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">UseCall</span> <span class="variable">useCall</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UseCall</span>();</span><br><span class="line">    FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(useCall);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();</span><br><span class="line">    System.out.println(futureTask.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šstart() æ–¹æ³•ä¸ä¸€å®šä»£è¡¨çº¿ç¨‹ç«‹å³æ‰§è¡Œï¼Œåªæ˜¯å‘Šè¯‰çº¿ç¨‹ç›®å‰å¤„äºå°±ç»ªçŠ¶æ€ï¼Œå…·ä½“ä»€ä¹ˆæ—¶é—´æ‰§è¡Œæ˜¯ç­‰å¾…ç³»ç»Ÿé€šçŸ¥çš„ã€‚</p>
<h1 id="4-çº¿ç¨‹çš„åœæ­¢"><a href="#4-çº¿ç¨‹çš„åœæ­¢" class="headerlink" title="4. çº¿ç¨‹çš„åœæ­¢"></a>4. çº¿ç¨‹çš„åœæ­¢</h1><p>å‰é¢è®²äº†å¼€å¯ <code>çº¿ç¨‹</code>ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¹Ÿè¦èƒ½åœæ­¢æ‰è¡Œå•Šã€‚</p>
<p>åœ¨è®²åœæ­¢ä¹‹å‰ï¼Œå…ˆè¡¥å……ä¸€ä¸‹ <strong>æŠ¢å å¼</strong> ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ï¼šåœ¨è°ƒç”¨ stop() æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹ç›´æ¥åœæ­¢ï¼ŒåŠ å…¥çº¿ç¨‹ç°åœ¨åœ¨å¤„ç†çš„ä¿¡æ¯æ˜¯å¦é‡è¦ï¼Œå¯èƒ½ä¼šé€ æˆä¸¢å¤±ï¼Œæ¯”å¦‚æ­£åœ¨å†™ä¸€ä¸ªå…³é”®æ–‡ä»¶ï¼Œå·²ç»å†™å…¥ 90%ï¼Œå¦‚æœæ­¤æ—¶åœæ­¢ï¼Œæ–‡ä»¶å°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´ä¿¡æ¯ä¸¢å¤±ã€‚</p>
<p>ç”±äº <strong>æŠ¢å å¼ä»»åŠ¡</strong> çš„ç§ç§å¼Šç«¯ï¼Œç°å·²åºŸå¼ƒ <strong>stop()</strong> æ–¹æ³•ï¼Œæ”¹ä¸º <strong>åä½œå¼ä»»åŠ¡</strong>ã€‚è¿™å°±æ¸©æŸ”çš„å¤šäº†ï¼Œåªæ˜¯å‘Šè¯‰ <code>çº¿ç¨‹</code>ï¼Œä½ è¢«æ‰“æ–­äº†ï¼Œçº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ‹©æ—¶åœæ­¢ï¼Œè¿™æ ·å°±èƒ½é¿å…ä¿¡æ¯ä¸¢å¤±ï¼ŒåŒæ—¶ï¼Œå¯¹å¼€å‘äººå‘˜çš„è¦æ±‚ä¹Ÿæé«˜äº†ä¸å°‘ã€‚</p>
<p>ä¸‹é¢ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹å‡ ä¸ªæ–¹æ³•ï¼Œé¿å…æ··æ·†ï¼›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Interrupts this thread.</span></span><br><span class="line"><span class="comment"> * Unless the current thread is interrupting itself, which is always permitted, the checkAccess method of this thread is invoked, which may cause a SecurityException to be thrown.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">interrupt</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span> != Thread.currentThread())</span><br><span class="line">        checkAccess();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">synchronized</span> (blockerLock) &#123;</span><br><span class="line">        <span class="type">Interruptible</span> <span class="variable">b</span> <span class="operator">=</span> blocker;</span><br><span class="line">        <span class="keyword">if</span> (b != <span class="literal">null</span>) &#123;</span><br><span class="line">            interrupt0(); <span class="comment">// Just to set the interrupt flagï¼Œæ³¨æ„è¿™ä¸ªå®˜æ–¹æ³¨é‡Šå“Ÿï¼Œè¿™é‡Œå…¶å®åªæ˜¯è®¾ç½®äº† interrupt æ ‡è¯†ç¬¦ï¼Œå…·ä½“æ˜¯å¦åœæ­¢è¦çœ‹çº¿ç¨‹æœ¬èº«ã€‚</span></span><br><span class="line">            b.interrupt(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    interrupt0();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯æµ‹è¯•çº¿ç¨‹æ˜¯å¦ interruptedï¼Œæ³¨æ„ä¼ çš„å‚æ•°ï¼Œå¦‚æœä¸º trueï¼Œåˆ™ä¼šæ¸…ç©ºå½“å‰ interrupted çŠ¶æ€ï¼Œåƒä¸‡è¦æ³¨æ„</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">(<span class="type">boolean</span> ClearInterrupted)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å…¶å®å°±æ˜¯è°ƒç”¨äº†ä¸Šé¢çš„ isInterrupted æ–¹æ³•ï¼Œå¹¶è¡¨ç¤ºä¸æ¸…é™¤ interrupted çŠ¶æ€</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isInterrupted</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> isInterrupted(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒä¸Šï¼Œä¸  isInterrupted() çš„åŒºåˆ«å°±æ˜¯ï¼šä¼šæ¸…é™¤ interrupted çŠ¶æ€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">interrupted</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> currentThread().isInterrupted(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-çº¿ç¨‹å¸¸ç”¨æ–¹æ³•"><a href="#5-çº¿ç¨‹å¸¸ç”¨æ–¹æ³•" class="headerlink" title="5. çº¿ç¨‹å¸¸ç”¨æ–¹æ³•"></a>5. çº¿ç¨‹å¸¸ç”¨æ–¹æ³•</h1><p>å‰é¢ä»‹ç»äº†å¼€å§‹ã€ç»“æŸï¼Œå†ä»‹ç»ä¸€ä¸‹çº¿ç¨‹çš„å…¶å®ƒå¸¸ç”¨æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th align="center">æ–¹æ³•</th>
<th align="center">ä»‹ç»</th>
</tr>
</thead>
<tbody><tr>
<td align="center">yield()</td>
<td align="center">native æ–¹æ³•ï¼Œçº¿ç¨‹ä»è¿è¡ŒçŠ¶æ€åˆ‡æ¢ä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯å°±ç»ªçŠ¶æ€</td>
</tr>
<tr>
<td align="center">sleep()</td>
<td align="center">native æ–¹æ³•ï¼Œçº¿ç¨‹ä¼šåˆ‡æ¢ä¸ºé˜»å¡çŠ¶æ€</td>
</tr>
<tr>
<td align="center">join()</td>
<td align="center">å®é™…ä¸Šå†…éƒ¨è°ƒç”¨äº† wait æ–¹æ³•ï¼Œçº¿ç¨‹åˆ‡æ¢ä¸ºé˜»å¡çŠ¶æ€</td>
</tr>
</tbody></table>
<h1 id="6-çº¿ç¨‹é”"><a href="#6-çº¿ç¨‹é”" class="headerlink" title="6. çº¿ç¨‹é”"></a>6. çº¿ç¨‹é”</h1><p>å‰é¢è®²åˆ°è¿‡ï¼Œè¿›ç¨‹ä¸‹çš„èµ„æºå¯¹æ‰€æœ‰å­çº¿ç¨‹å…±äº«ï¼Œé‚£ä¹ˆå­çº¿ç¨‹å°±å¯ä»¥å¯¹èµ„æºè¿›è¡Œè¯»å†™ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶æŠ¢å¤ºèµ„æºï¼Œå°±ä¼šå‡ºç°æ•°æ®é”™ä¹±ã€‚</p>
<p>åœ¨è®²é”ä¹‹å‰ï¼Œå…ˆè¯´è¯´ <strong>ç­‰å¾…å’Œé€šçŸ¥çš„æ ‡å‡†èŒƒå¼</strong>ï¼š</p>
<p><strong>ç­‰å¾…æ–¹</strong>ï¼š</p>
<ol>
<li>è·å–å¯¹è±¡çš„é”ï¼›</li>
<li>å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆè°ƒç”¨å¯¹è±¡çš„ wait() æ–¹æ³•ï¼Œè¢«é€šçŸ¥åä»è¦æ£€æŸ¥æ¡ä»¶ï¼›<br>3ã€å¦‚æœæ¡ä»¶æ»¡è¶³åˆ™æ‰§è¡Œå¯¹åº”çš„é€»è¾‘ï¼›</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(Object) &#123;</span><br><span class="line">    <span class="keyword">while</span>(æ¡ä»¶ä¸æ»¡è¶³) &#123;</span><br><span class="line">        Object.wait();</span><br><span class="line">    &#125;</span><br><span class="line">    å¯¹åº”çš„å¤„ç†é€»è¾‘</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¥æ”¶æ–¹</strong>:</p>
<ol>
<li>è·å¾—å¯¹è±¡çš„é”ï¼›</li>
<li>æ”¹å˜æ¡ä»¶ï¼›</li>
<li>é€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨å¯¹è±¡ä¸Šçš„çº¿ç¨‹ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(Object) &#123;</span><br><span class="line">    æ”¹å˜æ¡ä»¶</span><br><span class="line">    å¯¹è±¡.notifyAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆåˆ—ä¸¾ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">long</span> count)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹ count è¿›è¡Œç´¯åŠ ï¼Œç”±äºæ²¡æœ‰åŠ é”ï¼Œè®¡ç®—çš„ç»“æœä¼šåå°ï¼Œä¸æ­£ç¡®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incCount1</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ æ–¹æ³•é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">incCount2</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ æŒ‡å®šå¯¹è±¡é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incCount3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å½“å‰å¯¹è±¡é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incCount4</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯çº¿ç¨‹è¿›è¡Œæ“ä½œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Count</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> SynTest synTest;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Count</span><span class="params">(SynTest test)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.synTest = test;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">                synTest.incCount1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">SynTest</span> <span class="variable">synTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynTest</span>();</span><br><span class="line">        <span class="comment">// å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹å¯¹ count è¿›è¡Œæ“ä½œ</span></span><br><span class="line">        <span class="type">Count</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Count</span>(synTest);</span><br><span class="line">        <span class="type">Count</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Count</span>(synTest);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">50</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(synTest.getCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åŠ é”é™¤äº† synchronizedï¼Œè¿˜æœ‰æ˜¾ç¤ºé” Lockã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">LockDemo</span> <span class="variable">demo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LockDemo</span>();</span><br><span class="line">        demo.increment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lock æ˜¯è¿›è¡ŒåŠ é”ï¼Œä½†æ˜¯å¯¹äºé¢‘ç¹è¯»ã€å°‘é‡å†™çš„ IO æ“ä½œï¼Œå°±ä¼šå¤§å¤§é™ä½æ€§èƒ½ï¼ŒReadWriteLock å°±æ˜¯ç”¨æ¥å¤„ç†è¿™ç±»é—®é¢˜ï¼Œæ€§èƒ½è‡³å°‘æ˜¯ 10 å€æå‡ï¼Œå…¶å® ReadWriteLock ä¹Ÿå¾ˆç®€å•ï¼Œå…ˆçœ‹çœ‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ReadWriteLock</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the lock used for reading.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the lock used for reading</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Lock <span class="title function_">readLock</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the lock used for writing.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the lock used for writing</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Lock <span class="title function_">writeLock</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯ç”± 1 æŠŠé”å˜ä¸º 2 æŠŠé”ï¼Œè¯»é”ç›¸äº’ä¹‹é—´ä¸å¹²æ‰°ï¼Œå†™é”æ§åˆ¶æ‰€æœ‰é”ï¼Œè¿™æ ·å°±å¯èƒ½å°†æ€§èƒ½å¤§å¹…æå‡ã€‚</p>
<p>å…ˆæ¥å±•ç¤º Synchronized æ–¹å¼ç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseSyn</span> <span class="keyword">implements</span> <span class="title class_">GoodsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GoodsInfo goodsInfo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UseSyn</span><span class="params">(GoodsInfo goodsInfo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.goodsInfo = goodsInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> GoodsInfo <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.goodsInfo;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5</span>);</span><br><span class="line">            goodsInfo.changeNumber(number);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœä¸ºï¼š</span></span><br><span class="line">Thread-<span class="number">22</span>å†™å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">2247</span> ms----</span><br><span class="line">Thread-<span class="number">26</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">3051</span> ms</span><br><span class="line">Thread-<span class="number">15</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">5433</span> ms</span><br><span class="line">Thread-<span class="number">13</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">6265</span> ms</span><br><span class="line">Thread-<span class="number">16</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">6594</span> ms</span><br><span class="line">Thread-<span class="number">21</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">7508</span> ms</span><br><span class="line">Thread-<span class="number">25</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">7780</span> ms</span><br><span class="line">Thread-<span class="number">30</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">9123</span> ms</span><br><span class="line">Thread-<span class="number">32</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">9894</span> ms</span><br><span class="line">Thread-<span class="number">9</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">10379</span> ms</span><br><span class="line">Thread-<span class="number">5</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">11117</span> ms</span><br><span class="line">Thread-<span class="number">4</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">11264</span> ms</span><br><span class="line">Thread-<span class="number">3</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">11828</span> ms</span><br><span class="line">Thread-<span class="number">7</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">12215</span> ms</span><br><span class="line">Thread-<span class="number">10</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">12448</span> ms</span><br><span class="line">Thread-<span class="number">11</span>å†™å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">12506</span> ms----</span><br><span class="line">Thread-<span class="number">24</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">12630</span> ms</span><br><span class="line">Thread-<span class="number">0</span>å†™å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">12819</span> ms----</span><br><span class="line">Thread-<span class="number">14</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">13211</span> ms</span><br><span class="line">Thread-<span class="number">17</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">13617</span> ms</span><br><span class="line">Thread-<span class="number">18</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">14142</span> ms</span><br><span class="line">Thread-<span class="number">23</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">15084</span> ms</span><br><span class="line">Thread-<span class="number">27</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">15282</span> ms</span><br><span class="line">Thread-<span class="number">29</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">15700</span> ms</span><br><span class="line">Thread-<span class="number">1</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">16594</span> ms</span><br><span class="line">Thread-<span class="number">8</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">16966</span> ms</span><br><span class="line">Thread-<span class="number">6</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">17235</span> ms</span><br><span class="line">Thread-<span class="number">31</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">17336</span> ms</span><br><span class="line">Thread-<span class="number">28</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">17639</span> ms</span><br><span class="line">Thread-<span class="number">20</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">17919</span> ms</span><br><span class="line">Thread-<span class="number">19</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">18386</span> ms</span><br><span class="line">Thread-<span class="number">2</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">18631</span> ms</span><br><span class="line">Thread-<span class="number">12</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">18687</span> ms</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å±•ç¤º ReadWriteLock æ–¹å¼ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UseRwLock</span> <span class="keyword">implements</span> <span class="title class_">GoodsService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GoodsInfo goodsInfo;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">readLock</span> <span class="operator">=</span> lock.readLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">writeLock</span> <span class="operator">=</span> lock.writeLock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UseRwLock</span><span class="params">(GoodsInfo goodsInfo)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.goodsInfo = goodsInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GoodsInfo <span class="title function_">getNum</span><span class="params">()</span> &#123;</span><br><span class="line">        readLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5</span>);</span><br><span class="line">            <span class="keyword">return</span> goodsInfo;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> number)</span> &#123;</span><br><span class="line">        writeLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5</span>);</span><br><span class="line">            goodsInfo.changeNumber(number);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            writeLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœä¸ºï¼š</span></span><br><span class="line">Thread-<span class="number">11</span>å†™å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">219</span> ms----</span><br><span class="line">Thread-<span class="number">22</span>å†™å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">219</span> ms----</span><br><span class="line">Thread-<span class="number">0</span>å†™å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">274</span> ms----</span><br><span class="line">Thread-<span class="number">7</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">1</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">781</span> ms</span><br><span class="line">Thread-<span class="number">4</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">6</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">9</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">781</span> ms</span><br><span class="line">Thread-<span class="number">3</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">782</span> ms</span><br><span class="line">Thread-<span class="number">5</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">786</span> ms</span><br><span class="line">Thread-<span class="number">2</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">787</span> ms</span><br><span class="line">Thread-<span class="number">18</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">15</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">12</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">8</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">786</span> ms</span><br><span class="line">Thread-<span class="number">10</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">786</span> ms</span><br><span class="line">Thread-<span class="number">17</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">780</span> ms</span><br><span class="line">Thread-<span class="number">21</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">785</span> ms</span><br><span class="line">Thread-<span class="number">13</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">785</span> ms</span><br><span class="line">Thread-<span class="number">14</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">785</span> ms</span><br><span class="line">Thread-<span class="number">20</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">785</span> ms</span><br><span class="line">Thread-<span class="number">19</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">785</span> ms</span><br><span class="line">Thread-<span class="number">16</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">785</span> ms</span><br><span class="line">Thread-<span class="number">28</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">31</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">783</span> ms</span><br><span class="line">Thread-<span class="number">30</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">27</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">29</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">24</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">23</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">25</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">784</span> ms</span><br><span class="line">Thread-<span class="number">26</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">790</span> ms</span><br><span class="line">Thread-<span class="number">32</span>è¯»å–å•†å“æ•°æ®è€—æ—¶ï¼š<span class="number">789</span> ms</span><br></pre></td></tr></table></figure>

<p>åšåŒæ ·çš„æ—¶ï¼Œè€—æ—¶ç”± 18687 ms é™ä½ä¸º 790 msï¼Œç”±æ­¤å¯è§æ€§èƒ½æå‡ä¹‹å·¨å¤§ï¼Œå°ä¼™ä¼´ä»¬åœ¨åŠ é”çš„æ—¶å€™ï¼Œè¦æ³¨æ„é€‰æ‹©åˆé€‚çš„é”ï¼Œé¿å…æ€§èƒ½æµªè´¹ã€‚</p>
<h1 id="7-çº¿ç¨‹å˜é‡"><a href="#7-çº¿ç¨‹å˜é‡" class="headerlink" title="7. çº¿ç¨‹å˜é‡"></a>7. çº¿ç¨‹å˜é‡</h1><p>é”ä¿è¯äº†æ“ä½œèµ„æºçš„åŸå­æ€§ï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªç±»ä¸­ï¼Œå¸Œæœ›æ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„åˆå§‹å€¼ï¼Œè€Œä¸æ˜¯è¢«åˆ«çš„çº¿ç¨‹æ”¹å˜è¿‡åçš„å€¼ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœŸæœ›æ¯ä¸ªçº¿ç¨‹æ‹¿åˆ°è¿™ä¸ªå€¼éƒ½æ˜¯æŒ‡å®šå€¼ï¼Œç„¶åè¿›è¡Œå¤„ç†ï¼Œè€Œä¸è¢«å…¶å®ƒçº¿ç¨‹æ‰€å¹²æ‰°</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯åŠ¨ 3 ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startThreadArray</span><span class="params">()</span> &#123;</span><br><span class="line">    Thread[] runs = <span class="keyword">new</span> <span class="title class_">Thread</span>[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; runs.length; i++) &#123;</span><br><span class="line">        runs[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">TestTask</span>(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; runs.length; i++) &#123;</span><br><span class="line">        runs[i].start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæ˜¯æ— æ³•æ»¡è¶³è¦æ±‚çš„ï¼Œå¦‚ä½•å¤„ç†å‘¢ï¼Ÿ</p>
<p>åœ¨ç¿»é˜…äº†æºç åå‘ç°ï¼Œæœ‰ä¸€ä¸ª <strong>ThreadLocal</strong>ï¼Œå³ <code>çº¿ç¨‹å˜é‡</code>ï¼Œæ˜¯ä¸€ä¸ªä»¥ <strong>ThreadLocal</strong> å¯¹è±¡ä¸ºé”®ã€ä»»æ„å¯¹è±¡ä¸ºå€¼çš„å­˜å‚¨ç»“æ„ã€‚è¿™ä¸ªç»“æ„è¢«é™„å¸¦åœ¨çº¿ç¨‹ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ ¹æ®ä¸€ä¸ª <strong>ThreadLocal</strong> å¯¹è±¡æŸ¥è¯¢åˆ°ç»‘å®šåœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šçš„ä¸€ä¸ªå€¼ï¼Œç”¨æ¥å®ç°å˜é‡åœ¨çº¿ç¨‹ä¹‹é—´çš„éš”ç¦»ã€‚</p>
<p>ä¿®æ”¹åå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ”¹åŠ¨åï¼Œå³å¯æ»¡è¶³è¦æ±‚</span></span><br><span class="line"><span class="keyword">static</span> ThreadLocal&lt;Integer&gt; count = ThreadLocal.withInitial(() -&gt; <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h1 id="8-çº¿ç¨‹æ± "><a href="#8-çº¿ç¨‹æ± " class="headerlink" title="8. çº¿ç¨‹æ± "></a>8. çº¿ç¨‹æ± </h1><p><code>çº¿ç¨‹æ± </code> æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œç„¶ååœ¨åˆ›å»ºçº¿ç¨‹åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡ã€‚</p>
<p>ç®€å•ä¸€ç‚¹æ¥è¯´ï¼Œç”±äº <em>åˆ›å»ºçº¿ç¨‹</em> å’Œ <em>é”€æ¯çº¿ç¨‹</em> æ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºçš„ï¼Œå¯¹äºæ‰§è¡Œä»»åŠ¡å†…å®¹è¾ƒå°‘ä¸”æ•°é‡è¾ƒå¤šæ—¶ï¼Œæ•ˆç‡åä½ï¼Œå¦‚æœå°†èµ„æºæå‰åˆ›å»ºå¹¶ç¼“å­˜åˆ°èµ„æºæ± ä¸­ï¼Œæ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™å³æ‹¿å³ç”¨ï¼Œæ•ˆç‡ä¼šå¾—åˆ°å¤§å¹…æå‡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½æœ‰æ•ˆçš„ç®¡ç†çº¿ç¨‹èµ„æºã€‚</p>
<p>çº¿ç¨‹æ± ä¼˜ç‚¹ï¼š</p>
<ol>
<li>é™ä½èµ„æºæ¶ˆè€—ï¼›</li>
<li>æé«˜å“åº”é€Ÿåº¦ï¼›</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§ï¼›</li>
</ol>
<p>åœ¨ Java ä¸­ï¼Œç³»ç»Ÿæä¾›çš„æœ‰çº¿ç¨‹æ± ï¼šThreadPoolExecutorï¼Œé€šè¿‡æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬çŸ¥é“çº¿ç¨‹æ± å‡ ä¸ªæ ¸å¿ƒçš„æ§åˆ¶æ•°æ®ã€‚</p>
<blockquote>
<p>corePoolSize: çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œå¦‚æœ <code>çº¿ç¨‹æ± </code> ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äºç­‰äºè¿™ä¸ªæ•°å€¼åï¼Œç»§ç»­æäº¤çš„ä»»åŠ¡ä¼šè¢«ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œï¼›</p>
<p>maximumPoolSize: <strong>çº¿ç¨‹æ± </strong> ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œå¦‚æœå½“å‰é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶ä¸”ç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œä½†æ˜¯è¿™ä¸ªæ•°é‡è¦å°äº maximumPoolSizeï¼›</p>
<p>keepAliveTime: éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²æ—¶å­˜æ´»æ—¶é—´ï¼›</p>
<p>unit: keepAliveTime çš„æ—¶é—´å•ä½ï¼›</p>
<p>workQueue: å¿…é¡»æ˜¯ BlockQuene é˜»å¡é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°è¶…è¿‡ corePoolSize æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚</p>
<p>threadFactory: åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œå¯ä»¥è‡ªå®šä¹‰å¢åŠ æ›´å¤šæ§åˆ¶ã€èµ„æºä¿¡æ¯ï¼›</p>
<p>handler: é¥±å’Œç­–ç•¥ï¼Œå½“é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå¿…é¡»é‡‡ç”¨ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æä¾›äº† 4 ç§ç­–ç•¥:</p>
<ol>
<li><p>AbortPolicy: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›</p>
</li>
<li><p>CallerRunsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼›</p>
</li>
<li><p>DiscardOldestPolicyï¼šä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</p>
</li>
<li><p>DiscardPolicy: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›</p>
</li>
</ol>
<p>è¡¥å……ï¼šé™¤äº†è¿™ 4 ç§ç­–ç•¥å¤–ï¼Œè¿˜å¯ä»¥è‡ªå®šä¹‰ç­–ç•¥ï¼Œå“ªæ€•ä¸æ–°å¢å¤„ç†æ–¹æ¡ˆï¼Œå¯ä»¥è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œå¾…åˆé€‚æ—¶æœºä»æ–‡ä»¶ä¸­è¯»å–ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œæˆ–è€…è®°å½•æ—¥å¿—ï¼Œç•™å¤‡ä»¥ååˆ†æä½¿ç”¨ã€‚</p>
</blockquote>
<p>çº¿ç¨‹æ± æ¸…æ¥šäº†ï¼Œé‚£ä¹ˆå¦‚ä½•åˆç†é…ç½®çº¿ç¨‹æ± å‘¢ï¼Ÿæœ€ç»ˆè¦çš„æ˜¯åˆ†æä»»åŠ¡ç‰¹æ€§ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œåˆ†æï¼š</p>
<ol>
<li>ä»»åŠ¡çš„æ€§è´¨ï¼šCPU å¯†é›†å‹ã€IO å¯†é›†å‹å’Œæ··åˆä»»åŠ¡å‹ï¼›</li>
<li>ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼šé«˜ã€ä¸­å’Œä½ï¼›</li>
<li>ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼šé•¿ã€ä¸­å’ŒçŸ­ï¼›</li>
<li>ä»»åŠ¡çš„ä¾èµ–æ€§ï¼šæ˜¯å¦ä¾èµ–å…¶ä»–çš„ç³»ç»Ÿèµ„æºï¼Œå¦‚æ•°æ®åº“è¿æ¥ï¼›</li>
</ol>

  </div>
  <!--è¯„è®ºå—-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2021/01/04/Java/ä»å­—èŠ‚ç åˆ†æ i++ ä¸ ++i çš„åŒºåˆ«/" id="post_nav-newer" class="post-nav-content prev-content">
      <ä¸Šä¸€ç¯‡
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2020/12/25/Java/ä»£ç†ä¸åŠ¨æ€ä»£ç†/" id="post_nav-older" class="post-nav-content next-content">
      ä¸‹ä¸€ç¯‡>
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(æ— )</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#1-%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="post-toc-text">1. åŸºç¡€æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E7%BA%BF%E7%A8%8B%E4%BF%A1%E6%81%AF%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">2. æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ç¤ºä¾‹</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#3-%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="post-toc-text">3. çº¿ç¨‹çš„ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#4-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%81%9C%E6%AD%A2"><span class="post-toc-text">4. çº¿ç¨‹çš„åœæ­¢</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#5-%E7%BA%BF%E7%A8%8B%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="post-toc-text">5. çº¿ç¨‹å¸¸ç”¨æ–¹æ³•</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#6-%E7%BA%BF%E7%A8%8B%E9%94%81"><span class="post-toc-text">6. çº¿ç¨‹é”</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#7-%E7%BA%BF%E7%A8%8B%E5%8F%98%E9%87%8F"><span class="post-toc-text">7. çº¿ç¨‹å˜é‡</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#8-%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="post-toc-text">8. çº¿ç¨‹æ± </span></a></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a  id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#26A69A"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p >Copyright Â©  2017  Walker Denial</p>
<!-- <p >Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> & Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p> -->
<p style="font-size: 10px; margin-top: 0" id="footer-times" data-time="01/10/2017 00:00:00"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//åˆå§‹æ—¥æœŸ
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="æœ¬ç«™å·²è¿è¡Œ"+daysold+"å¤©"+hrsold+"å°æ—¶"+minsold+"åˆ†"+seconds+"ç§’";
    }
    show_date_time();
</script>

  </div>
</div>

<!--å½±é›†ç•Œé¢éœ€è¦çš„èµ„æº-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjaxæ“ä½œ
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

</body>
</html>
