<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="Walker Denial">
  <meta name="description" content="This is Walker Denial&#39;s blog!">
  
  <title>Walker Denial</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<meta name="generator" content="Hexo 7.0.0-rc2"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu" ><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav" >
    <div class="nav-header"  style="background-image: url(/images/header-bg.png);background-color:#26A69A">
    <div class="header-box"><img src="/images/profile.png" ondragstart="return false;"></div>
    <p>Walker Denial</p>
    <div class="nav-link">
        
        <a href="https://twitter.com/WalkerDenial" target="_blank"> <div class="link-box twitter"></div></a>
        
        
        <a  href="https://github.com/WalkerDenial" target="_blank"><div class="link-box github"></div></a>
        
        
        <a href="mailto:mailto:WalkerDenial@gmail.com"><div class="link-box email"></div></a>
        
        
        <a href="http://weibo.com/u/3213135930" target="_blank"><div class="link-box weibo"></div></a>
        
        
        <a href="https://www.zhihu.com/people/walkerdenial/activities" target="_blank"> <div class="link-box zhihu"></div></a>
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- æœç´¢æ¡†ç›¸å…³ -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="æœç´¢..." class="search form-control" autocomplete="off" autocorrect="off"/>
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- æœç´¢ç»“æœåŒº -->
        <p class='no-result'>æ— æœç´¢ç»“æœ</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>ä¸»é¡µ</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a  class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>å½’æ¡£</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2022/06/">June 2022<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/05/">May 2022<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/04/">April 2022<span class="archive-count">4</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/03/">March 2022<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/12/">December 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/11/">November 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/09/">September 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/08/">August 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/04/">April 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/03/">March 2021<span class="archive-count">12</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/02/">February 2021<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/01/">January 2021<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/12/">December 2020<span class="archive-count">5</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/11/">November 2020<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/04/">April 2020<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/01/">January 2018<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/12/">December 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/11/">November 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/08/">August 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/07/">July 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/03/">March 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/02/">February 2017<span class="archive-count">20</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/01/">January 2017<span class="archive-count">2</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a   class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>åˆ†ç±»</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/Algorithm/">Algorithm<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/ES6/">ES6<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Flutter/">Flutter<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Gradle/">Gradle<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Java/">Java<span class="category-count">6</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Kotlin/">Kotlin<span class="category-count">4</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/RPC/">RPC<span class="category-count">3</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/UML/">UML<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">å…¶ä»–<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%86%99%E4%BD%9C/">å†™ä½œ<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯<span class="category-count">10</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">æ“ä½œç³»ç»Ÿ<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%87%AA%E5%AD%A6/">è‡ªå­¦<span class="category-count">9</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/">è®¡ç®—æœºç³»ç»Ÿç»“æ„<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">è®¡ç®—æœºç½‘ç»œ<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼<span class="category-count">27</span></a>
    </li>
</ul>
<!--tags-->

<li class="nav-list">
    <a href="/archives" target="_self">
        <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>æ ‡ç­¾</p>
    </a>
</li>

<!--photo-->

<!--friends-->

<!--about-->

<li class="nav-list">
    <a href="/about" target="_self">
        <div class="nav-ico"><i class="material-icons">copyright</i> </div><p>å…³äº</p>
    </a>
</li>


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title"  style="background-color:#26A69A;background-image:url(/images/random/vateral-9.png)" >
  <h2>ä»£ç†ä¸åŠ¨æ€ä»£ç†</h2>
    
  <p>ä½œè€… : Walker Denial &nbsp&nbsp å‘å¸ƒäº : <time datetime="2020-12-25T15:23:00.000Z">
          2020-12-25
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <p>åœ¨å‰é¢å­¦ä¹  <code>è®¾è®¡æ¨¡å¼</code> çš„æ—¶å€™ï¼Œå­¦ä¹ è¿‡ <a target="_blank" rel="noopener" href="https://walkerdenial.com/2017/02/24/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/">ä»£ç†æ¨¡å¼</a>ï¼Œå¦‚æœæ²¡çœ‹è¿‡çš„å¯ä»¥ç‚¹å‡»é“¾æ¥çœ‹ä¸€ä¸‹ã€‚</p>
<p>æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„æ˜¯ <strong>æ²¡æœ‰ä¸­é—´å•†èµšå·®ä»·</strong>ï¼Œ<strong>ä»£ç†</strong> å…¶å®å°±ç›¸å½“äºæ˜¯ <strong>ä¸­é—´å•†</strong>ï¼Œæ—¢ç„¶ä¸­é—´å•†ä¼šèµšå·®ä»·ï¼ˆé¢å¤–å¢åŠ å¼€é”€ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ <strong>ä»£ç†</strong> å‘¢ï¼Ÿ</p>
<p>ä¸¾ä¸ªæ —å­ï¼Œç°åœ¨éœ€è¦è´­ä¹°é£Ÿç‰©å¤§ç±³ï¼Œä½ æ˜¯ç›´æ¥å»è¶…å¸‚ã€å°å–éƒ¨ã€ç²®æ²¹åº—ç­‰ <strong>ä¸­é—´å•†</strong> å¤„ä¹°å‘¢ï¼Ÿè¿˜æ˜¯ç›´æ¥ä¸‹ä¹¡ï¼Œå»ç§æ¤æˆ·é‡Œè´­ä¹°ï¼Ÿå¦‚æœç›´æ¥è´­ä¹°çš„è¯ï¼Œä½ ä¸ä»…è¦çŸ¥é“ä½ éœ€è¦çš„æ˜¯å¤§ç±³ï¼Œè¿˜éœ€è¦çŸ¥é“å¤§ç±³äº§è‡ªå“ªé‡Œã€å“ªä¸ªå­£èŠ‚æ”¶è·ã€å“ªä¸ªåŒºåŸŸå”®å–ç­‰ç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œä¼šé¢å¤–å¢åŠ æ¶ˆè´¹è€…è´Ÿæ‹…ï¼Œè€Œè¿™äº›ï¼Œå…¶å®å¯ä»¥äº¤ç»™ <strong>ä»£ç†</strong> æå®šå°±è¡Œäº†ï¼Œçœå¿ƒã€çœåŠ›ã€‚</p>
<h1 id="1-é™æ€ä»£ç†"><a href="#1-é™æ€ä»£ç†" class="headerlink" title="1. é™æ€ä»£ç†"></a>1. é™æ€ä»£ç†</h1><p><img src="https://personal-blog.oss-cn-hangzhou.aliyuncs.com/static_proxy.jpg" alt="é™æ€ä»£ç†"></p>
<p>åœºæ™¯ï¼šè´­ä¹°å¤§ç±³ã€‚</p>
<p>Step. 1 å®šä¹‰é£Ÿç‰©æ¥å£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IFood</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buyFood</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Step. 2 å®šä¹‰å¤§ç±³</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RiceFood</span> <span class="keyword">implements</span> <span class="title class_">IFood</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyFood</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;buy food for rice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Step. 3 ä»£ç†å…¥åœº</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é£Ÿç‰©ä»£ç†ç±»</span></span><br><span class="line"><span class="comment"> * ä½œç”¨ï¼šç”¨æˆ·åªéœ€è¦é€šè¿‡ä»£ç†å•†è´­ä¹°é£Ÿç‰©ï¼Œè€Œä¸éœ€è¦å»å†œç”°é‡Œè´­ä¹°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NormalFoodProxy</span> <span class="keyword">implements</span> <span class="title class_">IFood</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IFood food;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NormalFoodProxy</span><span class="params">(IFood food)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.food = food; <span class="comment">// è®¾ç½®å…·ä½“ä»£ç†å•†</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡å§”æ‰˜ä»£ç†å•†è´­ä¹°å•†å“</span></span><br><span class="line"><span class="comment">     * å¥½å¤„ï¼šå¯ä»¥å¯¹å•†å“è¿›è¡ŒåŠ å·¥å¤„ç†</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buyFood</span><span class="params">()</span> &#123;</span><br><span class="line">        beforeSale();</span><br><span class="line">        food.buyFood();</span><br><span class="line">        afterSale();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å”®å‰æœåŠ¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">beforeSale</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä»£ç†å•†æ£€æŸ¥é£Ÿç‰©æ˜¯å¦å®‰å…¨&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å”®åæœåŠ¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">afterSale</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä»£ç†å•†æä¾›é€è´§ä¸Šé—¨æœåŠ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Step. 4 æ¶ˆè´¹è€…è´­ä¹°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1. æ‰¾åˆ°ä»£ç†å•†å¹¶å‘Šè¯‰ taï¼Œéœ€è¦è´­ä¹°å¤§ç±³</span></span><br><span class="line"><span class="type">NormalFoodProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">new</span> NormalFoodProxy(<span class="keyword">new</span> <span class="title class_">RiceFood</span>());</span><br><span class="line"><span class="comment">// 2. è´­ä¹°å¤§ç±³</span></span><br><span class="line">proxy.buyRice();</span><br></pre></td></tr></table></figure>

<p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œ2 æ­¥å°±æå®šäº†ï¼ŒèŠ±è´¹ä¸€äº›å¯ä»¥æ¥å—çš„ä»£ä»·ï¼Œå°½å¿«æ»¡è¶³éœ€æ±‚ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ</p>
<p>åšè¿‡æ”¯ä»˜çš„åŒå­¦åº”è¯¥æ·±æœ‰ä½“ä¼šï¼Œæ˜¯å¯¹æ¥æ”¯ä»˜å®ã€å¾®ä¿¡æ”¯ä»˜å‘¢ï¼Œè¿˜æ˜¯åˆ†åˆ«å¯¹æ¥å‡ ç™¾å®¶é“¶è¡Œæ–¹ä¾¿ï¼Œç›¸æ¯”ä¸ç”¨å¤šè¯´äº†å§ã€‚</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>é€šè¿‡ä»£ç†å¯ä»¥æä¾›å¢å€¼æœåŠ¡ï¼ˆæ‰©å±•æ›´å¤šä¿¡æ¯ï¼‰</li>
<li>é€šè¿‡ä»£ç†å¯ä»¥ä¸éœ€è¦çŸ¥é“å…·ä½“å®ç°ç»†èŠ‚</li>
</ol>
<p>åŒæ—¶ï¼Œç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p>
<ol>
<li>å¢åŠ ä¸€ä¸ªæ–°çš„æ“ä½œï¼Œéœ€è¦å¢åŠ æ–°çš„æ¥å£ï¼Œè¿åå¼€é—­åŸåˆ™ï¼Œå¯æ‰©å±•æ€§å·®</li>
<li>è™½ç„¶ä¸éœ€è¦çŸ¥é“å…·ä½“å®ç°ç»†èŠ‚ï¼Œä½†æ˜¯éœ€è¦çŸ¥é“å…·ä½“å®ç°ç±»ï¼Œé€ æˆç±»çš„é¢å¤–è´Ÿæ‹…</li>
<li>è¿˜æ˜¯éœ€è¦çŸ¥é“å…·ä½“å®ç°ç±»ï¼Œå¯¼è‡´ç±»å˜å¾—å¤æ‚</li>
</ol>
<p>å¦‚æœéœ€è¦çš„ç§ç±»æˆåƒä¸Šä¸‡ï¼Œé‚£ä¹ˆä»£ç†ç±»å°±ä¼šåºå¤§åˆ°æ— æ³•ç»´æŠ¤ï¼Œæ‰€ä»¥ <code>åŠ¨æ€ä»£ç†</code> åº”ç”¨è€Œç”Ÿã€‚</p>
<h1 id="2-åŠ¨æ€ä»£ç†"><a href="#2-åŠ¨æ€ä»£ç†" class="headerlink" title="2. åŠ¨æ€ä»£ç†"></a>2. åŠ¨æ€ä»£ç†</h1><p>åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯ JDK æä¾›çš„ <strong>Proxy</strong> å’Œ <strong>InvocationHandler</strong>ã€‚</p>
<p>ç»“åˆ Proxy æ³¨é‡Šä»‹ç» Proxy æ˜¯ä»€ä¹ˆï¼š</p>
<blockquote>
<p>Proxy provides static methods for creating dynamic proxy classes and instances, and it is also the superclass of all dynamic proxy classes created by those methods.</p>
</blockquote>
<p>ç®€å•ç¿»è¯‘ä¸€ä¸‹å°±æ˜¯ï¼šProxy æä¾›é™æ€æ–¹æ³•ç”¨æ¥åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å’Œå®ä¾‹ï¼Œæ‰€æœ‰çš„åŠ¨æ€ä»£ç†ç±»éƒ½åŸºäºå®ƒã€‚</p>
<p>çœ‹æ¥ï¼Œæƒ³è¦ä½¿ç”¨åŠ¨æ€ä»£ç†æ˜¯ç»•ä¸è¿‡ <strong>Proxy</strong> çš„äº†ã€‚</p>
<p>ä¸ <strong>Proxy</strong> ç´§å¯†ç»“åˆçš„ï¼Œè¿˜è¦æœ‰ ** InvocationHandler** ç±»ã€‚</p>
<blockquote>
<p>InvocationHandler is the interface implemented by the invocation handler of a proxy instance.</p>
<p>Each proxy instance has an associated invocation handler. When a method is invoked on a proxy instance, the method invocation is encoded and dispatched to the invoke method of its invocation handler.</p>
</blockquote>
<p>ä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œå°±åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span><br><span class="line">        <span class="keyword">throws</span> Throwable;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆï¼Œ<strong>Proxy</strong> å€’æ˜¯æ˜¯å¦‚ä½•ç»“åˆ <strong>InvocationHandler</strong> çš„å‘¢ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Proxy</span> <span class="keyword">implements</span> <span class="title class_">java</span>.io.Serializable &#123;</span><br><span class="line">	<span class="comment">// çœç•¥è‹¥å¹²ä»£ç </span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// parameter types of a proxy class constructor</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Class&lt;?&gt;[] constructorParams = &#123; InvocationHandler.class &#125;;</span><br><span class="line">	<span class="comment">// a cache of proxy classes</span></span><br><span class="line">	<span class="keyword">protected</span> InvocationHandler h;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">newProxyInstance</span><span class="params">(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</span> <span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line">		<span class="comment">// çœç•¥è‹¥å¹²ä»£ç </span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// é€šè¿‡åå°„çš„æ–¹å¼å°† InvocationHandler å¯¹è±¡ h ä¼ é€’ç»™å®ä¾‹åŒ–çš„ç±»</span></span><br><span class="line">		<span class="keyword">return</span> cons.newInstance(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;h&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åçœ‹ä¸€ä¸‹åŠ¨æ€ç”Ÿæˆçš„ç±»ä¸­ <strong>InvocationHandler</strong> å¦‚ä½•å·¥ä½œçš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">buyFood</span><span class="params">()</span> <span class="keyword">throws</span>  &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    	  <span class="comment">// è°ƒç”¨ InvocationHandler çš„ invoke æ–¹æ³•è¿›è¡Œå¤„ç†</span></span><br><span class="line">    	  <span class="comment">// ç”±æ­¤å¯è§ï¼Œè‡ªå®šä¹‰åŠ¨æ€ä»£ç†éœ€è¦å®ç° InvocationHandler çš„ï¼Œè¦ä¸ç„¶æµç¨‹æ— æ³•èµ°é€š</span></span><br><span class="line">        <span class="built_in">super</span>.h.invoke(<span class="built_in">this</span>, m3, (Object[])<span class="literal">null</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">        <span class="keyword">throw</span> var2;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UndeclaredThrowableException</span>(var3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•´ä½“ JDK å®ç°æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://personal-blog.oss-cn-hangzhou.aliyuncs.com/dynamic_proxy.png" alt="åŠ¨æ€ä»£ç†"></p>
<h1 id="3-åŠ¨æ€ä»£ç†ç¤ºä¾‹"><a href="#3-åŠ¨æ€ä»£ç†ç¤ºä¾‹" class="headerlink" title="3. åŠ¨æ€ä»£ç†ç¤ºä¾‹"></a>3. åŠ¨æ€ä»£ç†ç¤ºä¾‹</h1><p>ç”±ä¸Šé¢æºç åˆ†æï¼Œè‡ªå®šä¹‰åŠ¨æ€ä»£ç†ç±»éœ€è¦ implements InvocationHandlerï¼Œå…ˆå®šä¹‰ä¸€ä¸ªä»£ç†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// é™¤äº† InvocationHandlerï¼Œä¸éœ€è¦å®ç°é¢å¤–æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object factory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFactory</span><span class="params">(Object factory)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ Proxy è·å¾—åŠ¨æ€ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxyInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(factory.getClass().getClassLoader(),</span><br><span class="line">                factory.getClass().getInterfaces(), <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡åŠ¨æ€ä»£ç†æ–¹æ³•è¿›è¡Œå¢å¼º</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        doBefore();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(factory, args);</span><br><span class="line">        doAfter();</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doBefore</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æä¾›ä»£ç†å‰æœåŠ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doAfter</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æä¾›ä»£ç†åæœåŠ¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–åŠ¨æ€ä»£ç†ç±»</span></span><br><span class="line">    <span class="type">DynamicProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DynamicProxy</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»£ç† RiceFoodï¼ˆæ­¤æ—¶åŠ¨æ€ä»£ç†ç±»é‡Œé¢æ²¡æœ‰å®ç° IFood æ¥å£ï¼‰</span></span><br><span class="line">    <span class="type">RiceFood</span> <span class="variable">riceFood</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RiceFood</span>();</span><br><span class="line">    proxy.setFactory(riceFood);</span><br><span class="line">    <span class="comment">// è·å–åŠ¨æ€ä»£ç†ç±»å®ä¾‹</span></span><br><span class="line">    <span class="type">IFood</span> <span class="variable">riceProxy</span> <span class="operator">=</span> (IFood) proxy.getProxyInstance();</span><br><span class="line">    riceProxy.buyFood();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</span><br><span class="line"></span><br><span class="line">æä¾›ä»£ç†å‰æœåŠ¡</span><br><span class="line">buy food <span class="keyword">for</span> rice</span><br><span class="line">æä¾›ä»£ç†åæœåŠ¡</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼šç›¸è¾ƒäºé™æ€ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å¯æ‰©å±•æ€§æ›´å¼ºï¼ŒRetrofit ä½¿ç”¨çš„å°±æ˜¯ åŠ¨æ€ä»£ç†ï¼ŒSpring ä¸­ä¹Ÿå¤§é‡ä½¿ç”¨åˆ°åŠ¨æ€ä»£ç†ï¼ŒæŒæ¡å¥½åŠ¨æ€ä»£ç†ï¼Œèƒ½æå‡æ¡†æ¶æ­å»ºçš„èƒ½åŠ›ã€‚</p>

  </div>
  <!--è¯„è®ºå—-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2020/12/30/Java/å¤šçº¿ç¨‹/" id="post_nav-newer" class="post-nav-content prev-content">
      <ä¸Šä¸€ç¯‡
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2020/12/14/Java/æ¥å£ä¸æŠ½è±¡ç±»çš„åŒºåˆ«/" id="post_nav-older" class="post-nav-content next-content">
      ä¸‹ä¸€ç¯‡>
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(æ— )</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#1-%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="post-toc-text">1. é™æ€ä»£ç†</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#2-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="post-toc-text">2. åŠ¨æ€ä»£ç†</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#3-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%A4%BA%E4%BE%8B"><span class="post-toc-text">3. åŠ¨æ€ä»£ç†ç¤ºä¾‹</span></a></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a  id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#26A69A"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p >Copyright Â©  2017  Walker Denial</p>
<!-- <p >Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> & Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p> -->
<p style="font-size: 10px; margin-top: 0" id="footer-times" data-time="01/10/2017 00:00:00"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//åˆå§‹æ—¥æœŸ
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="æœ¬ç«™å·²è¿è¡Œ"+daysold+"å¤©"+hrsold+"å°æ—¶"+minsold+"åˆ†"+seconds+"ç§’";
    }
    show_date_time();
</script>

  </div>
</div>

<!--å½±é›†ç•Œé¢éœ€è¦çš„èµ„æº-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjaxæ“ä½œ
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

</body>
</html>
