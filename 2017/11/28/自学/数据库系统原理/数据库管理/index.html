<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  
  <meta name="keywords" content="Walker Denial">
  <meta name="description" content="This is Walker Denial&#39;s blog!">
  
  <title>Walker Denial</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/materialize.min.css">
    
      <link rel="stylesheet" href="/css/main.min.css">
    
  
  <style type="text/css">
      html{
          font-family: sans-serif;
          font-weight: 300;
      }
      @font-face {
          font-family: 'Material Icons';
          font-style: normal;
          font-weight: 400;
          src: url(/fonts/MaterialIcons-Regular.eot);
          src: url(/fonts/MaterialIcons-Regular.woff2) format('woff2'),
          url(/fonts/MaterialIcons-Regular.woff) format('woff'),
          url(/fonts/MaterialIcons-Regular.ttf) format('truetype')
      }
  </style>
<meta name="generator" content="Hexo 7.0.0-rc2"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
<body>
<div id="menu-box"><a href="javascript:void(0)" id="menu" data-activates="slide-out" class="button-collapse menu" ><span class="nav-btn"></span></a></div>
<div id="menu-outer">
  <div id="menu-inner">
      <ul id="slide-out" class="side-nav" >
    <div class="nav-header"  style="background-image: url(/images/header-bg.png);background-color:#26A69A">
    <div class="header-box"><img src="/images/profile.png" ondragstart="return false;"></div>
    <p>Walker Denial</p>
    <div class="nav-link">
        
        <a href="https://twitter.com/WalkerDenial" target="_blank"> <div class="link-box twitter"></div></a>
        
        
        <a  href="https://github.com/WalkerDenial" target="_blank"><div class="link-box github"></div></a>
        
        
        <a href="mailto:mailto:WalkerDenial@gmail.com"><div class="link-box email"></div></a>
        
        
        <a href="http://weibo.com/u/3213135930" target="_blank"><div class="link-box weibo"></div></a>
        
        
        <a href="https://www.zhihu.com/people/walkerdenial/activities" target="_blank"> <div class="link-box zhihu"></div></a>
        
    </div>
    <div class="nav-search">
        <form id="search-form"> <!-- 搜索框相关 -->
            <input type="text" id="local-search-input" name="q" results="0" placeholder="搜索..." class="search form-control" autocomplete="off" autocorrect="off"/>
            <div class="nav-search-img"><i class="material-icons">search</i></div>
        </form>
        <div id="local-search-result"></div> <!-- 搜索结果区 -->
        <p class='no-result'>无搜索结果</p>
    </div>
</div>
    <!--Homepage-->

<li class="nav-list">
    <a href="/" target="_self">
        <div class="nav-ico"><i class="material-icons">home</i> </div><p>主页</p>
    </a>
</li>

<!--archives-->

<li class="nav-list dropdown-btn">
    <a  class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">assignment</i></div><p>归档</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="archive-link" href="/archives/2022/06/">June 2022<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/05/">May 2022<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/04/">April 2022<span class="archive-count">4</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2022/03/">March 2022<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/12/">December 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/11/">November 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/09/">September 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/08/">August 2021<span class="archive-count">3</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/04/">April 2021<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/03/">March 2021<span class="archive-count">12</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/02/">February 2021<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2021/01/">January 2021<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/12/">December 2020<span class="archive-count">5</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/11/">November 2020<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2020/04/">April 2020<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2018/01/">January 2018<span class="archive-count">2</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/12/">December 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/11/">November 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/08/">August 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/07/">July 2017<span class="archive-count">1</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/03/">March 2017<span class="archive-count">6</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/02/">February 2017<span class="archive-count">20</span></a></li><li class="nav-dropdown-list"><a class="archive-link" href="/archives/2017/01/">January 2017<span class="archive-count">2</span></a>
    </li>
</ul>
<!--categories-->

<li class="nav-list dropdown-btn">
    <a   class=""  target="_self">
        <div class="nav-ico"><i class="material-icons">dashboard</i></div><p>分类</p><div class="dropdown-ico"><i class="material-icons">arrow_drop_down</i></div>
    </a>
</li>

<ul class="dropdown-menu dropdown" >
    <li class="nav-dropdown-list">
        <a class="category-link" href="/categories/Algorithm/">Algorithm<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/ES6/">ES6<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Flutter/">Flutter<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Gradle/">Gradle<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Java/">Java<span class="category-count">6</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/Kotlin/">Kotlin<span class="category-count">4</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/RPC/">RPC<span class="category-count">3</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/UML/">UML<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%85%B6%E4%BB%96/">其他<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%86%99%E4%BD%9C/">写作<span class="category-count">1</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端<span class="category-count">10</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">操作系统<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%87%AA%E5%AD%A6/">自学<span class="category-count">9</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/">计算机系统结构<span class="category-count">7</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络<span class="category-count">2</span></a></li><li class="nav-dropdown-list"><a class="category-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式<span class="category-count">27</span></a>
    </li>
</ul>
<!--tags-->

<li class="nav-list">
    <a href="/archives" target="_self">
        <div class="nav-ico"><i class="material-icons">bookmark</i> </div><p>标签</p>
    </a>
</li>

<!--photo-->

<!--friends-->

<!--about-->

<li class="nav-list">
    <a href="/about" target="_self">
        <div class="nav-ico"><i class="material-icons">copyright</i> </div><p>关于</p>
    </a>
</li>


</ul>

  </div>
</div>

<div id="content-outer">
  <div id="content-inner">
    
<article id="post">
  <div class="post-page-title"  style="background-color:#26A69A;background-image:url(/images/random/vateral-12.png)" >
  <h2>数据库管理</h2>
    
  <p>作者 : Walker Denial &nbsp&nbsp 发布于 : <time datetime="2017-11-28T06:15:00.000Z">
          2017-11-28
    </time>
  </p>
    
  </div>
  <div class="post-page-content">
  <p>在 DBS 运行时，DBMS 要对 DB 进行监控，以保证整个系统的正常运转，防止数据意外丢失和不一致数据的产生。DBMS 对 DB 的监控，称为数据库的管理，有时也称为数据库的保护。对数据库的管理主要通过四个方面实现：数据库的恢复、并发控制、完整性控制和安全性控制。每一方面构成了 DBMS 的一个子系统。DBS 运行的最小逻辑工作单位是「事务」，所有对数据库的操作，都要以事务作为一个整体单位来执行或者撤销。</p>
<h3 id="1-事务"><a href="#1-事务" class="headerlink" title="1. 事务"></a>1. 事务</h3><h4 id="1-1-事务的定义"><a href="#1-1-事务的定义" class="headerlink" title="1.1 事务的定义"></a>1.1 事务的定义</h4><p><code>事务（Transaction）</code>是构成单一逻辑工作单元的操作集合，要么完整地执行，要么完全不执行。不论发生何种情况，DBS 必须保证事务能正确、完整地执行。</p>
<h4 id="1-2-事务的-ACID-性质"><a href="#1-2-事务的-ACID-性质" class="headerlink" title="1.2 事务的 ACID 性质"></a>1.2 事务的 ACID 性质</h4><p><strong>1. 原子性（Atomicity）</strong></p>
<p>一个事务对数据库的所有操作，是一个不可分割的工作单元。这些操作要么全部执行，要么什么也不做（就对 DB 的效果而言）。</p>
<p><strong>2. 一致性（Consistency）</strong></p>
<p>一个事务独立执行的结果，应保持数据库的一致性，即数据不会因事务的执行而遭受破坏。</p>
<p><strong>3. 隔离性（Isolation）</strong></p>
<p>在多个事务并发执行时，系统应保证与这些事务先后单独执行时的结果一样，此时称事务达到了隔离性的要求。也就是在多个事务并发执行时，保证执行结果是正确的，如果单用户环境一样。</p>
<p><strong>4. 持久性（Durability）</strong></p>
<p>一个事务一旦完成全部操作后，它对数据库的所有更新应永久地反映在数据库中，不会丢失。即使以后系统发生故障，也是如此。</p>
<h3 id="2-数据库的恢复"><a href="#2-数据库的恢复" class="headerlink" title="2. 数据库的恢复"></a>2. 数据库的恢复</h3><blockquote>
<p>系统能把数据库从被破坏、不正确的状态，恢复到最近一个正确的状态，DBMS 的这种能力称为数据库的可恢复性（Recovery）。</p>
</blockquote>
<h4 id="2-1-典型的恢复策略"><a href="#2-1-典型的恢复策略" class="headerlink" title="2.1 典型的恢复策略"></a>2.1 典型的恢复策略</h4><p><strong>（1）平时做好两件事：转储和建立日志</strong></p>
<ol>
<li>周期地（比如一天一次）对整个数据库进行拷贝，转储到另一个磁盘或磁带一类存储介质中</li>
<li>建立日志数据库。记录事务的开始、结束标志，记录事务对数据库的每一次插入、删除和修改前后的值，写到「日志」库中，以便有案可查。</li>
</ol>
<p><strong>（2）一旦发生数据库故障，分两种情况进行处理</strong></p>
<ol>
<li>如果数据库遇到灾难性故障，例如磁头脱落、磁盘损坏等，这时数据库已不能用了，就必须装入最近一次拷贝的数据库备份到新的磁盘，然后利用日志库执行「重做」（REDO）已提交的事务，把数据库恢复到故障前的状态</li>
<li>如果数据库未遭到物理性破坏，但破坏了数据库的一致性（某些数据不正确），此时不必去拷贝存档的数据库，只要利用日志库「撤销」（UNDO）所有不可靠的修改，再利用日志库执行「重做」（REDO）已提交的、但对数据库的更新可能还留在内存缓冲区的事务，就可以把数据库恢复到正确的状态。</li>
</ol>
<h4 id="2-2-故障类型和恢复方法"><a href="#2-2-故障类型和恢复方法" class="headerlink" title="2.2 故障类型和恢复方法"></a>2.2 故障类型和恢复方法</h4><p><strong>1. 事务故障</strong></p>
<p>事务故障又可分为两种：</p>
<ol>
<li>可以预期的事务故障，即在程序中可以预先估计到的错误，譬如存款余额透支，商品库存量达到最低量等，此时继续取款或发货就会出现问题。这种情况可以在事务的代码中加入判断和 ROLLBACK 语句。当事务执行到 ROLLBACK 语句时，由系统对事务进行回退操作，即执行 UNDO 操作</li>
<li>非预期的事务故障，即在程序中发生的未估计到的错误，譬如运算溢出、数据错误、并发事务发生死锁而被选中撤销该事务等。此时由系统直接对该事务执行 UNDO 处理</li>
</ol>
<p><strong>2. 系统故障</strong></p>
<p>引起系统停止运转随之要求重新启动的事件称为「系统故障」。</p>
<p>重新启动时，具体处理分两种情况考虑：</p>
<ul>
<li>对未完成事务作 UNDO 处理；</li>
<li>对已提交事务但更新还留在缓冲区的事务进行 REDO 处理；</li>
</ul>
<p><strong>3. 介质故障</strong></p>
<p>在发生介质故障和遭受病毒破坏时，磁盘上的物理数据库遭到毁灭性破坏。此时恢复的过程如下：</p>
<ol>
<li>重装最近转储的后备副本到新的磁盘，使数据库恢复到转储时的一致状态</li>
<li>在日志中找出最近转储以后所有已提交的事务</li>
<li>对这些已提交的事务进行 REDO 处理，将数据库恢复到故障前某一时刻的一致状态</li>
</ol>
<h4 id="2-3-检查点技术"><a href="#2-3-检查点技术" class="headerlink" title="2.3 检查点技术"></a>2.3 检查点技术</h4><p><strong>1. 检查点方法</strong></p>
<p>前面多次提到的 REDO（重做）和 UNDO（撤销）处理，实际上是采用检查点（Check-point）方法实现的，大多数 DBMS 产品都提供这种技术。</p>
<p><strong>2. 检查点方法的恢复算法</strong></p>
<ol>
<li>根据日志文件建立事务重做队列和事务撤销队列</li>
<li>对重做队列中的事务进行 REDO 处理，对撤销队列中的事务进行 UNDO 处理</li>
</ol>
<h3 id="3-数据库的并发控制"><a href="#3-数据库的并发控制" class="headerlink" title="3. 数据库的并发控制"></a>3. 数据库的并发控制</h3><h4 id="3-1-并发操作带来的三个问题"><a href="#3-1-并发操作带来的三个问题" class="headerlink" title="3.1 并发操作带来的三个问题"></a>3.1 并发操作带来的三个问题</h4><p>在多用户共享系统中，许多事务可能同时对同一数据进行操作（「并发操作」），此时可能会破坏数据库的完整性。这里的「并发」（Concurrent）是指在单处理机（一个 CPU）上，利用分时方法实行多个事务同时做。</p>
<p>数据库的并发操作通常会带来三个问题：丢失更新问题、读脏数据问题、不可重复读问题。</p>
<p>在数据库技术中，把未提交的随后被撤销的数据称为「脏数据」。</p>
<h4 id="3-2-封锁技术"><a href="#3-2-封锁技术" class="headerlink" title="3.2 封锁技术"></a>3.2 封锁技术</h4><blockquote>
<p>锁（Lock）是一个与数据项相关的变量，对可能应用于该数据项上的操作而言，锁描述了该数据项的状态。</p>
</blockquote>
<p>通常在数据库中每个数据项都有一个锁。锁的作用是使并发事务对数据库中数据项的访问能够同步。封锁技术中主要有两种封锁：排他型封锁（Exclusive Lock）和共享型封锁（Shared Lock）。</p>
<p><strong>1. 排他型封锁（X 锁）</strong></p>
<blockquote>
<p>如果事务 T 对某个数据 R（可以是数据项、记录、数据集乃至整个数据库）实现了 X 锁，那么在 T 对数据 R 解除封锁之前，不允许其他事务 T 再对该数据加任何类型的锁。这种锁称为「X 锁」。</p>
</blockquote>
<p>使用 X 锁的操作有两个：</p>
<ul>
<li>申请 X 锁操作「XFIND R」：表示事务对数据 R 申请加 X 锁，若成功，则可以读或写数据 R；如果不成功，那么这个事务将进入等待队列，一直到获准 X 锁，事务才能继续做下去。</li>
<li>解除 X 锁操作「XRELEASE R」：表示事务要解除对数据 R 的 X 锁。</li>
</ul>
<p><strong>2. 共享型封锁（S 锁）</strong></p>
<blockquote>
<p>如果事务 T 对某数据加上 S 锁后，仍允许其他事务再对该数据加 S 锁，但在对该数据的所有 S 锁都解除之前决不允许任何事务对该数据加 X 锁。</p>
</blockquote>
<p>使用 S 锁的操作有三个：</p>
<ul>
<li>申请 S 锁操作「SFIND R」：表示事务对数据 R 申请加 S 锁，若成功，则可以读数据 R，但不可以写数据 R；如果不成功，那么这个事务将进入等待队列，一直到获准 S 锁，事务才能继续做下去。</li>
<li>升级和写操作「UPDX R」：表示事务要把对数据 R 的 S 锁升级为 X 锁，若成功则更新数据 R，否则这个事务进入等待队列。</li>
<li>解除 S 锁操作「SRELEASE R」：表示事务要解除对数据 R 的 S 锁。</li>
</ul>
<p><strong>3. 封锁的相容矩阵</strong></p>
<p><img src="http://personal-blog.oss-cn-hangzhou.aliyuncs.com/db_lock_type.png" alt="封锁类型的相容矩阵"></p>
<p><strong>4. 封锁的粒度</strong></p>
<p>X 锁和 S 锁都是加在某一个数据对象上的。封锁的对象可以是逻辑单元，也可以是物理单元。</p>
<blockquote>
<p>封锁对象的大小称为封锁的粒度（Granularity）。</p>
</blockquote>
<p>封锁粒度与系统的并发度和并发控制的开销密切相关。封锁的粒度越大，并发度也就越小，但同时系统的开销也就越小；相反，封锁的粒度越小，并发度越高，但系统开销也就越大。</p>
<p>因此，在一个系统中同时存在不同大小的封锁单元供不同的事务选择使用是比较理想的。而选择封锁粒度时必须同时考虑封锁机构和并发度两个因素，对系统开销与并发度进行权衡，以求得最优的效果。一般说来，需要处理大量元组的用户事务可以以关系为封锁单元；而对于一个处理少量元组的用户事务，可以以元组为封锁单位以提高并发度。</p>
<p><strong>5. 封锁协议</strong></p>
<p>利用封锁技术，可以避免并发操作引起的各种错误，但有可能产生其他三个问题：活锁，饿死和死锁。</p>
<p><img src="http://personal-blog.oss-cn-hangzhou.aliyuncs.com/db_lock_aggreement.png" alt="封锁协议的内容和优缺点"></p>
<h4 id="3-3-并发操作的调度"><a href="#3-3-并发操作的调度" class="headerlink" title="3.3 并发操作的调度"></a>3.3 并发操作的调度</h4><p><strong>1. 事务的调度、串行调度和并发调度</strong></p>
<blockquote>
<p>事务的执行次序称为「调度」。如果多个事务一次执行，则称为事务的串行调度（Serial Schedule）。如果利用分时的方法，同时处理多个事务，则称为事务的并发调度（Concurrent Schedule）。</p>
</blockquote>
<p><strong>2. 可串行化概念</strong></p>
<blockquote>
<p>每个事务中，语句的先后顺序在各种调度中始终保持一致。在这个前提下，如果一个并发调度的执行结果与某一串行调度的执行结果等价，那么，这个并发调度称为「可串行化的调度」，否则是不可串行化的调度。</p>
</blockquote>
<h4 id="3-4-SQL-对并发处理的支持"><a href="#3-4-SQL-对并发处理的支持" class="headerlink" title="3.4 SQL 对并发处理的支持"></a>3.4 SQL 对并发处理的支持</h4><p>SQL2 对事务的 <code>存取模式（Access Mode）</code> 和 <code>隔离级别（Isolation Level）</code> 做了具体规定，并提供语句让用户使用，以控制事务的并发执行。</p>
<p><strong>1. 事务的存取模式</strong></p>
<p>SQL2 允许事务有两种模式：</p>
<ol>
<li>READ ONLY（只读型）：事务对数据库的操作只能是读操作。定义这个模式后，表示随后的事务均是只读型。</li>
<li>READ WRITE（读写型）：事务对数据库的操作可以是读操作，也可以是写操作。定义这个模式后，表示随后的事务均是读写型。在程序开始时默认这种模式。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> TRANSACTION READ <span class="keyword">ONLY</span></span><br><span class="line"><span class="keyword">SET</span> TRANSACTION READ WRITE</span><br></pre></td></tr></table></figure>

<p><strong>2. 事务的隔离级别</strong></p>
<p>SQL2 提供事务的四种隔离级别让用户选择。这四个级别从高到低如下所述：</p>
<ol>
<li>SERIALIZABLE（可串行化）：允许事务与其他事务并发执行，但系统必须保证并发度是可串行化的，不致发生错误。在程序开始时默认这个级别。</li>
<li>REPEATABLE READ（可重复读）：只允许事务读已提交的数据，并且在两次读同一数据时不允许其他事务修改此数据。</li>
<li>READ COMMITTED（读提交数据）：允许事务读已提交的数据，但不要求「可重复读」。</li>
<li>READ UNCOMMITTED（可以读未提交的数据）：允许事务读已提交或未提交的数据。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE</span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ</span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL READ COMMITTED</span><br><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</span><br></pre></td></tr></table></figure>

<h3 id="4-数据库的完整性"><a href="#4-数据库的完整性" class="headerlink" title="4. 数据库的完整性"></a>4. 数据库的完整性</h3><h4 id="4-1-完整性子系统"><a href="#4-1-完整性子系统" class="headerlink" title="4.1 完整性子系统"></a>4.1 完整性子系统</h4><blockquote>
<p>数据库中完整性（Integrity）一词是指数据的正确性（Correctness）、有效性（Validity）和相容性（Consistency），防止错误的数据进入数据库。</p>
</blockquote>
<p>DBMS 中执行完整性检查的子系统称为「完整性子系统」。完整性子系统的主要功能有两点：</p>
<ol>
<li>监督事务的执行，并测试是否违反完整性规则；</li>
<li>若有违反现象，则采取恰当的操作，譬如拒绝操作、报告违反情况、改正错误等方法来处理。</li>
</ol>
<h4 id="4-2-SQL-中的完整性约束"><a href="#4-2-SQL-中的完整性约束" class="headerlink" title="4.2 SQL 中的完整性约束"></a>4.2 SQL 中的完整性约束</h4><p>SQL 中把完整性约束分成三大类：<code>域约束</code>、<code>基本表约束</code> 和 <code>断言</code>。</p>
<p><strong>1. 域约束</strong></p>
<p>SQL 可以用「CREATE DOMAIN」语句定义新的域，并且还可出现 CHECK 字句。</p>
<p><strong>2. 基本表约束</strong></p>
<p>SQL 的基本表约束主要有三种形式：候选键定义、外键定义和「检查约束」定义。这些定义都可以再前面加「CONSTRAINT&lt;约束名&gt;」，由此为新约束起个名字。</p>
<p><strong>3. 断言</strong></p>
<p>如果完整性的约束牵涉面较广，与多个关系有关，或者与聚合操作有关，那么 SQL2 提供「断言」（Assertions）机制让用户书写完整性约束。断言可以像关系一样，用 CREATE 语句定义，其句法如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CHECK</span> ASSERTION <span class="operator">&lt;</span>断言名<span class="operator">&gt;</span> <span class="keyword">CHECK</span> (<span class="operator">&lt;</span>条件<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure>

<p>撤销断言的句法是：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> ASSERTION <span class="operator">&lt;</span>断言名<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-SQL3-的触发器"><a href="#4-3-SQL3-的触发器" class="headerlink" title="4.3 SQL3 的触发器"></a>4.3 SQL3 的触发器</h4><blockquote>
<p>触发器（Trigger）是一个能由系统自动执行对数据库修改的语句。触发器有时也称为主动规则（Active Rule）或事件—条件—动作规则（Event-Condition-Action Rule，ECA 规则）。</p>
</blockquote>
<p>一个触发器由三个部分组成：</p>
<ol>
<li>事件。事件是指对数据库的插入、删除、修改等操作。触发器在这些事件发生时，将开始工作。</li>
<li>条件。触发器将测试条件是否成立。如果条件成立，就执行相应的动作，否则什么也不做。</li>
<li>动作。如果触发器测试满足预定的条件，那么，就由 DBMS 执行这些动作（即对数据库的操作）。这些动作能使触发事件不发生，即撤销事件，例如删除一插入的元组等。这些动作也可以是一系列对数据库的操作，甚至可以是与触发事件本身无关的其他操作。</li>
</ol>
<p><strong>触发器结构的组成</strong></p>
<p><em><strong>（1）动作时间</strong></em></p>
<p>触发器的动作时间定义了何时想要执行触发器动作。在 SQL 标准中规定可以是 BEFORE 或 AFTER。</p>
<ol>
<li>BEFORE：在触发事件进行以前，测试 WHEN 条件是否满足。若满足则先执行动作部分的操作，然后再执行触发事件的操作（此时可不管 WHEN 条件是否满足）。</li>
<li>AFTER：在触发事件完成以后，测试 WHEN 条件是否满足，若满足则执行动作部分的操作。</li>
<li>（在 Oracle 系统中才有）INSTEAD OF：在触发事件发生时。只要满足 WHEN 条件，就执行动作部分的操作，而触发事件的操作不再执行。</li>
</ol>
<p><em><strong>（2）触发事件</strong></em></p>
<p>触发事件定义了激活触发器的 SQL 数据更新语句的类别。触发事件有三类：UPDATE、DELETE 和 INSERT。只有在 UPDATE 时，允许后面跟「OF &lt;属性表&gt;」短语。在其他两种弄情况时，是对整个元组的操作，不允许后面跟「OF &lt;属性表&gt;」短语。</p>
<p><em><strong>（3）目标表（ON 短语）</strong></em></p>
<p>当目标表的数据被更新（插入、删除、修改）时，将激活触发器。</p>
<p><em><strong>（4）旧值和新值的别名表（REFERENCES 子句）</strong></em></p>
<p>如果触发事件是 UPDATE，那么，应该用「OLD AS」和「NEW AS」子句定义修改前后的元组变量。如果是 DELETE，那么只要用「OLD AS」子句定义元组变量。如果是 INSERT，那么，只要用「NEW AS」子句定义元组变量。</p>
<p><em><strong>（5）触发动作</strong></em></p>
<p>触发动作定义了当触发器被激活时想要它执行的 SQL 语句，有三个部分：动作间隔尺寸，动作时间条件和动作体。</p>
<p><code>动作间隔尺寸</code> 用 FOR EACH 子句定义，有两种形式：FOR EACH ROW 和 FOR EACH STATEMENT。前者对每一个修改的元组都要检查一次，而后者对 SQL 语句的执行结果去检查。前一种形式的触发器称为「元组级触发器」，后一种形式的触发器称为「语句级触发器」。</p>
<p><code>动作时间条件</code> 用 WHEN 子句定义，它可以是任意的条件表达式。当触发器被激活时，如果条件是 true，则执行动作体的 SQL 语句，否则不执行。</p>
<p><code>动作体</code> 定义了触发动作本身：当触发器被激活时想要 DBMS 执行的 SQL 语句。动作体若举一个 SQL 语句，直接写上即可；若是一系列的 SQL 语句，则用分号定界，再使用 BEGIN ATOMIC …… END 限定。</p>
<h3 id="5-数据库的安全性"><a href="#5-数据库的安全性" class="headerlink" title="5. 数据库的安全性"></a>5. 数据库的安全性</h3><h4 id="5-1-安全性问题"><a href="#5-1-安全性问题" class="headerlink" title="5.1 安全性问题"></a>5.1 安全性问题</h4><p><strong>1. 数据库安全性的定义</strong></p>
<blockquote>
<p>数据库的安全性（Security）是指保护数据库，防止不合法的使用，以免数据的泄密、更改或破坏。</p>
</blockquote>
<p><strong>安全性</strong> 是保护数据以防止非法用户故意造成的破坏；而 <strong>完整性</strong> 是保护数据以防止合法用户无意中造成的破坏。也就是安全性确保用户被限制在做其想做的事情；而完整性确保用户所做的事情是正确的。</p>
<p><strong>2. 安全性界别</strong></p>
<ol>
<li>环境级：计算机系统的机房和设备应加以保护，防止有人进行物理破坏。</li>
<li>职员级：工作人员应清正廉洁，正确授予用户访问数据库的权限。</li>
<li>OS 级：应防止未经授权的用户从 OS 处着手访问数据库。</li>
<li>网络级：由于大多数 DBS 都允许用户通过网络进行远程访问，因此，网络软件内部的安全性是很重要的。</li>
<li>DBS 级：DBS 的职责是检查用户的身份是否合法及使用数据库的权限是否正确。</li>
</ol>
<p><strong>3. 权限问题</strong></p>
<blockquote>
<p>用户（或应用程序）使用数据库的方式称为「权限」（Authorization）。</p>
</blockquote>
<p>权限有两种：访问数据的权限和修改数据库结构的权限。</p>
<p><em><strong>（1）访问数据的权限有四个：</strong></em></p>
<ol>
<li>读（Read）权限：允许用户读数据，但不能修改数据。</li>
<li>插入（Insert）权限：允许用户插入新的数据，但不能修改数据。</li>
<li>修改（Update）权限：允许用户修改数据，但不能删除数据。</li>
<li>删除（Delete）权限：允许用户删除数据。</li>
</ol>
<p><em><strong>（2）修改数据库模式的权限也有四个：</strong></em></p>
<ol>
<li>索引（Index）权限：允许用户创建和删除索引。</li>
<li>资源（Resource）权限：允许用户创建新的关系。</li>
<li>修改（Alteration）权限：允许用户在关系结构中加入或删除属性。</li>
<li>撤销（Drop）权限：允许用户撤销关系。</li>
</ol>
<h4 id="5-2-SQL-中的安全性机制"><a href="#5-2-SQL-中的安全性机制" class="headerlink" title="5.2 SQL 中的安全性机制"></a>5.2 SQL 中的安全性机制</h4><p>SQL 中有四个机制提供了安全性：视图（View）、权限（Authorization）、角色（Role）和审计（Audit）。</p>
<p><strong>1. 视图</strong></p>
<p>视图是从一个或多个基本表导出的表。但视图仅是一个定义，视图本身没有数据，不占磁盘空间。视图一经定义就可以和基本表一样被查询，也可以用来定义新的视图，但更新（插、删、改）操作将有一定的限制。</p>
<p>视图机制使系统具有三个优点：数据安全性、逻辑数据独立性和操作简便性。</p>
<p><strong>2. 权限</strong></p>
<p>DBMS 的授权子系统允许有特定存取权限的用户有选择地和动态地把这些权限授予其他用户。</p>
<p><strong>3. 角色</strong></p>
<blockquote>
<p>在 SQL 中，用户（User）是实际的人或是访问数据库的应用程序。而角色（Role）是一组具有相同权限的用户，实际上角色是属于目录一级的概念。</p>
</blockquote>
<p><strong>4. 审计</strong></p>
<blockquote>
<p>用于安全性目的的数据库日志，称为审计追踪（Audit Trail）。</p>
</blockquote>
<h4 id="5-3-常用的安全性措施"><a href="#5-3-常用的安全性措施" class="headerlink" title="5.3 常用的安全性措施"></a>5.3 常用的安全性措施</h4><ol>
<li>强制存取控制（Mandatory Access Control）</li>
<li>统计数据库的安全性</li>
<li>自然环境的安全性</li>
</ol>

  </div>
  <!--评论块-->
    

</article>
<nav class="post-nav">
  <!-- Prev Nav -->
    
  <a href="/2017/12/18/自学/计算机网络原理/计算机网络概述/" id="post_nav-newer" class="post-nav-content prev-content">
      <上一篇
  </a>
    


  <!-- Next Nav -->
    
  <a href="/2017/11/24/自学/数据库系统原理/SQL 语言/" id="post_nav-older" class="post-nav-content next-content">
      下一篇>
  </a>
    
</nav>
<div class="post-toc-btn"><i class="material-icons">format_list_numbered</i></div>
<div class="post-toc-none"><p>(无)</p></div>
<div class="post-toc-box">
    <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-%E4%BA%8B%E5%8A%A1"><span class="post-toc-text">1. 事务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-1-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="post-toc-text">1.1 事务的定义</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-2-%E4%BA%8B%E5%8A%A1%E7%9A%84-ACID-%E6%80%A7%E8%B4%A8"><span class="post-toc-text">1.2 事务的 ACID 性质</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%81%A2%E5%A4%8D"><span class="post-toc-text">2. 数据库的恢复</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-1-%E5%85%B8%E5%9E%8B%E7%9A%84%E6%81%A2%E5%A4%8D%E7%AD%96%E7%95%A5"><span class="post-toc-text">2.1 典型的恢复策略</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-2-%E6%95%85%E9%9A%9C%E7%B1%BB%E5%9E%8B%E5%92%8C%E6%81%A2%E5%A4%8D%E6%96%B9%E6%B3%95"><span class="post-toc-text">2.2 故障类型和恢复方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-3-%E6%A3%80%E6%9F%A5%E7%82%B9%E6%8A%80%E6%9C%AF"><span class="post-toc-text">2.3 检查点技术</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="post-toc-text">3. 数据库的并发控制</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1-%E5%B9%B6%E5%8F%91%E6%93%8D%E4%BD%9C%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%B8%89%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="post-toc-text">3.1 并发操作带来的三个问题</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2-%E5%B0%81%E9%94%81%E6%8A%80%E6%9C%AF"><span class="post-toc-text">3.2 封锁技术</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3-%E5%B9%B6%E5%8F%91%E6%93%8D%E4%BD%9C%E7%9A%84%E8%B0%83%E5%BA%A6"><span class="post-toc-text">3.3 并发操作的调度</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4-SQL-%E5%AF%B9%E5%B9%B6%E5%8F%91%E5%A4%84%E7%90%86%E7%9A%84%E6%94%AF%E6%8C%81"><span class="post-toc-text">3.4 SQL 对并发处理的支持</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="post-toc-text">4. 数据库的完整性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-1-%E5%AE%8C%E6%95%B4%E6%80%A7%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="post-toc-text">4.1 完整性子系统</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-2-SQL-%E4%B8%AD%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7%E7%BA%A6%E6%9D%9F"><span class="post-toc-text">4.2 SQL 中的完整性约束</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-3-SQL3-%E7%9A%84%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="post-toc-text">4.3 SQL3 的触发器</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7"><span class="post-toc-text">5. 数据库的安全性</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-1-%E5%AE%89%E5%85%A8%E6%80%A7%E9%97%AE%E9%A2%98"><span class="post-toc-text">5.1 安全性问题</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-2-SQL-%E4%B8%AD%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E6%9C%BA%E5%88%B6"><span class="post-toc-text">5.2 SQL 中的安全性机制</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-3-%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E6%8E%AA%E6%96%BD"><span class="post-toc-text">5.3 常用的安全性措施</span></a></li></ol></li></ol>
</div>
<!--<div class="post-back"><i class="material-icons">arrow_back</i></div>-->
<script type="text/javascript">
    menu();
</script>
  </div>
</div>
<div id="bottom-outer">
  <div id="bottom-inner">
    <a  id="top-button" onfocus="this.blur();"><div class="up upinbody" style="background-color:#26A69A"><i class="material-icons material-up">vertical_align_top</i></div></a>


<p >Copyright ©  2017  Walker Denial</p>
<!-- <p >Powered by <a href="https://hexo.io/" target="_blank"> Hexo </a> & Theme - <a href="https://github.com/moumao/hexo-theme-Vateral" target="_blank">Vateral</a></p> -->
<p style="font-size: 10px; margin-top: 0" id="footer-times" data-time="01/10/2017 00:00:00"></p>
<script>
    var beginTime=document.getElementById("footer-times").dataset.time
    function show_date_time(){
        var span=document.getElementById("footer-times")
        window.setTimeout("show_date_time()", 1000);
        BirthDay=new Date(beginTime);//初始日期
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        e_hrsold=(e_daysold-daysold)*24;
        hrsold=Math.floor(e_hrsold);
        e_minsold=(e_hrsold-hrsold)*60;
        minsold=Math.floor((e_hrsold-hrsold)*60);
        seconds=Math.floor((e_minsold-minsold)*60);
        span.innerHTML="本站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
    }
    show_date_time();
</script>

  </div>
</div>

<!--影集界面需要的资源-->



<!-- scripts list from theme config.yml -->

<script src="/js/jquery-3.1.1.min.js"></script>

<script src="/js/materialize.min.js"></script>

<script src="/js/main.min.js"></script>


<script>
    NProgress.start();
    NProgress.done();
    lazy();
    links();
    window.onpopstate = menu();
    //pjax操作
    $(document).pjax('a:not(.nopjax)', '#content-inner', {fragment:'#content-inner', timeout:8000});
    $(document).on('pjax:start', NProgress.start).on('pjax:end', NProgress.done)
        .on('pjax:end', () => {
            dowmdiv();
            lazy();
            toc();
            links();
            menu();
        });
</script>

</body>
</html>
